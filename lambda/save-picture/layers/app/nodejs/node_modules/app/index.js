const dotenv = require('dotenv');
dotenv.config({ path: require('path').resolve(__dirname, '.env') });
const Sentry = require('@sentry/node');
const AWSXRay = require('aws-xray-sdk');

if (process.env.APP_ENV !== 'local') {
    Sentry.init({
        dsn: process.env.SENTRY_NODE_DSN,
        environment: process.env.APP_ENV
    });

    AWSXRay.captureAWS(require('aws-sdk'));
    AWSXRay.captureHTTPsGlobal(require('http'));
    AWSXRay.captureHTTPsGlobal(require('https'));
}

const errorHandler = async (err) => {
    if (process.env.APP_ENV !== 'local') {
        Sentry.captureException(err);
        await Sentry.flush();
    }
    // eslint-disable-next-line no-console
    console.log(err);
};

const redis = require('@respond-io/redis').instance();

module.exports = {
    dotenv,
    errorHandler,
    redis
};
